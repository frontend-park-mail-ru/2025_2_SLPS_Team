<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>molecules/LoginForm/LoginFrom.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RegistrationForm.html">RegistrationForm</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-FormInput.html">FormInput</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-LoginForm.html">LoginForm</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-FormInput.html">FormInput</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-LoginForm.html">LoginForm</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderFeed">renderFeed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderFormButton">renderFormButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderIconButton">renderIconButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderMenu">renderMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderMenuItem">renderMenuItem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderNavButton">renderNavButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderPost">renderPost</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">molecules/LoginForm/LoginFrom.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import FormInput from "../../atoms/FormInput/FromInput.js";
import { renderFormButton } from "../../atoms/FormButtons/FormButton.js";
import CONFIG from '/config.js'


/**
 * Модуль `LoginForm` предоставляет класс для создания и управления формой входа.
 * Использует Handlebars-шаблон `LoginForm.hbs`, а также компоненты `FormInput` и `renderFormButton`.
 * @module LoginForm
 */

/**
 * Класс, представляющий форму авторизации пользователя.
 */ 
export default class LoginForm {
    /**
     * Создаёт экземпляр LoginForm.
     *
     * @param {HTMLElement} container - Контейнер, в который будет отрендерена форма.
     * @param {Object} [options={}] - Дополнительные опции.
     * @param {Function} [options.onSubmit] - Колбэк, вызываемый при успешной отправке формы.
     * @param {Function} [options.onReg] - Колбэк, вызываемый при нажатии кнопки регистрации.
     */
    constructor(container, options = {}) {
        this.container = container;
        this.options = options;
        this.form = null;
        this.inputs = {};
    }

    async render() {
        const template = Handlebars.templates['LoginFrom.hbs'];
        const html = template();

        const wrapper = document.createElement("div");
        wrapper.innerHTML = html.trim();

        this.form = wrapper.querySelector("form");
        
        this.container.appendChild(this.form);

        const inputContainer = this.form.querySelector('.input-container'); 
        const buttons = this.form.querySelector('.button-container')

        this.inputs.email = new FormInput(inputContainer, {
            name: "email",
            label: "Email",
            type: "text",
            placeholder: "Введите email",
            required: true,
            showRequired: true,
        });
        await this.inputs.email.render();

        this.inputs.password = new FormInput(inputContainer, {
            name: "password",
            label: "Пароль",
            type: "password",
            placeholder: "Введите пароль",
            required: true,
            showRequired: true,
        });
        await this.inputs.password.render();

        await renderFormButton(buttons, "submit", "Войти", "accent", (e) => {
            e.preventDefault();
            this.handleSubmit();
        });


        await renderFormButton(buttons, "button", "Регистрация", "base", (e) => {
            e.preventDefault();
            this.handleRegister();
        });


        this.container.appendChild(this.form);
    }

    handleSubmit() {
        const { email, password, rememberMe } = this.getValues();
        console.log(email,password,rememberMe);
        fetch(`${CONFIG.API_BASE_URL}/api/auth/login`, {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: email,
                    password: password
                }),
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        console.log("Успешный вход");
                            if (this.options.onSubmit) {
                                this.options.onSubmit({ email, password });
                            }
                    } else {
                        this.inputs.email.showError("Неверный email");
                        this.inputs.password.showError("Неверный пароль");
                    }
                })
                .catch(err => {
                    console.error("Ошибка при запросе:", err);
                });
    }

    handleRegister() {
        if (this.options.onReg) {
            this.options.onReg();
        }
    }



    getValues() {
        const rememberMeInput = this.form.querySelector('input[name="rememberMe"]');
        return {
            email: this.inputs.email.input.value.trim(),
            password: this.inputs.password.input.value.trim(),
            rememberMe: rememberMeInput? rememberMeInput.checked : false,
        };
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Mon Sep 29 2025 10:23:55 GMT+0300 (Moscow Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
